# Makefile.build: Trigger Bazel build

.PHONY: all bazel-build

all: bazel-build

# Makefile.build: Unified build, lint, and format

.PHONY: all bazel-build lint lint-cpp lint-python format format-cpp format-python deps deps-ndpi

all: deps bazel-build lint format

# Dependency targets
deps: deps-ndpi

deps-ndpi:
	@echo "Initializing nDPI submodule..."
	git submodule update --init --recursive nDPI
	@echo "nDPI submodule ready"

# Build targets
bazel-build:
	bazel build //...

# Lint targets
lint: lint-cpp lint-python

lint-cpp:
	clang-tidy src/*.cpp -- -Iinclude

lint-python:
	uv pip install ruff
	ruff agent/

# Format targets
format: format-cpp format-python

format-cpp:
	clang-format -i src/*.cpp include/*.h

format-python:
	uv pip install ruff
	ruff format agent/
